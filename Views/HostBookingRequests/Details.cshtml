@model RentalService.Models.BookingRequest
@{
    ViewData["Title"] = "Booking Request Details";
}
<div class="card shadow-sm mb-4">
    <div class="card-header bg-info text-white fw-bold">
        <i class="fa-solid fa-envelope"></i> Booking Request Details
    </div>
    <div class="card-body">
        <p><strong>Room:</strong> <a href="@Url.Action("Details", "Rooms", new { id = Model.RoomId })" target="_blank">@Model.Room?.Name</a></p>
        <p><strong>Customer:</strong> @Model.User?.Name</p>
        <p><strong>Message:</strong> @Model.Message</p>
        <p><strong>Status:</strong> 
            @if (Model.Status.ToString() == "Pending")
            {
                <span class="badge bg-warning">Pending</span>
            }
            else if (Model.Status.ToString() == "Approved")
            {
                <span class="badge bg-success">Approved</span>
            }
            else if (Model.Status.ToString() == "Rejected")
            {
                <span class="badge bg-danger">Rejected</span>
            }
            else if (Model.Status.ToString() == "Cancelled")
            {
                <span class="badge bg-secondary">Cancelled</span>
            }
            else
            {
                <span class="badge bg-secondary">@Model.Status</span>
            }
        </p>
        @if (Model.Status.ToString() == "Pending")
        {
            <div class="mb-3 d-flex gap-2">
                <form id="approveForm" method="post" action="@Url.Action("Approve", "HostBookingRequests")" style="display:inline;">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.Id" />
                    <button type="submit" class="btn btn-success me-2">Approve</button>
                </form>
                <form id="rejectForm" method="post" action="@Url.Action("Reject", "HostBookingRequests")" style="display:inline;">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.Id" />
                    <button type="submit" class="btn btn-danger">Reject</button>
                </form>
            </div>
        }
        <p><strong>Created:</strong> @Model.CreatedAt</p>
        @if (Model.Room != null) {
            <p><strong>Price:</strong> @Model.Room.Price.ToString("N0") â‚«</p>
        }
        @if (Model.Room != null && Model.Room.Building != null && Model.Room.Building.Host != null && Model.Room.Building.Host.ContactInformations != null && Model.Room.Building.Host.ContactInformations.Count > 0)
        {
            <div class="mt-3">
                <h5>Host Contact Information</h5>
                <ul>
                    @foreach (var c in Model.Room.Building.Host.ContactInformations)
                    {
                        if (c.Type.ToString() == "FacebookLink")
                        {
                            <li><strong>@c.Type:</strong> <a href="@c.Data" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg me-1"></i>View Profile</a></li>
                        }
                        else if (c.Type.ToString() == "Email")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy email"><i class="fa fa-copy"></i></button></li>
                        }
                        else if (c.Type.ToString() == "PhoneNumber")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy phone"><i class="fa fa-copy"></i></button></li>
                        }
                        else
                        {
                            <li><strong>@c.Type:</strong> @c.Data</li>
                        }
                    }
                </ul>
            </div>
        }
        @if (Model.User != null && Model.User.ContactInformations != null && Model.User.ContactInformations.Count > 0)
        {
            <div class="mt-3">
                <h5>Customer Contact Information</h5>
                <ul>
                    @foreach (var c in Model.User.ContactInformations)
                    {
                        if (c.Type.ToString() == "FacebookLink")
                        {
                            <li><strong>@c.Type:</strong> <a href="@c.Data" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg me-1"></i>View Profile</a></li>
                        }
                        else if (c.Type.ToString() == "Email")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy email"><i class="fa fa-copy"></i></button></li>
                        }
                        else if (c.Type.ToString() == "PhoneNumber")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy phone"><i class="fa fa-copy"></i></button></li>
                        }
                        else
                        {
                            <li><strong>@c.Type:</strong> @c.Data</li>
                        }
                    }
                </ul>
            </div>
        }
    </div>
</div>
<div class="d-flex gap-2">
    <a href="@Url.Action("Index", "HostDashboard")" class="btn btn-outline-secondary"><i class="fa-solid fa-gauge-high"></i> Dashboard</a>
    <a href="@Url.Action("Index")" class="btn btn-outline-info"><i class="fa-solid fa-list"></i> Back to Requests</a>
</div>
<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text);
        toastr.success('Copied to clipboard!');
    }
    $(function () {
        $('#approveForm, #rejectForm').submit(function (e) {
            e.preventDefault();
            var form = $(this);
            var btn = form.find('button[type="submit"]');
            btn.prop('disabled', true);
            $.ajax({
                url: form.attr('action'),
                type: 'POST',
                data: form.serialize(),
                success: function (res) {
                    if (res.success) {
                        toastr.success(res.message);
                        setTimeout(function(){ location.reload(); }, 1200);
                    } else {
                        toastr.error(res.message);
                        btn.prop('disabled', false);
                    }
                },
                error: function () {
                    toastr.error('An error occurred.');
                    btn.prop('disabled', false);
                }
            });
        });
    });
</script>
<form id="antiForgeryForm" style="display:none;">
    @Html.AntiForgeryToken()
</form>
<style>
    .copy-btn {
        border: none;
        background: none;
        color: #007bff;
        cursor: pointer;
        margin-left: 0.5rem;
    }
</style>
