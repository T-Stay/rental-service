@model IEnumerable<RentalService.Models.AdPost>
@{
    ViewData["Title"] = "Quản lý bài quảng cáo";
}
<h2 class="mb-4">Quản lý bài quảng cáo</h2>
<form method="get" class="row g-2 align-items-end mb-3">
    <div class="col-md-3">
        <label class="form-label mb-1">Gói dịch vụ</label>
        <select name="packageType" class="form-select">
            @{
                var pkg = Context.Request.Query["packageType"].ToString();
                if (string.IsNullOrEmpty(pkg)) {
                    <option value="" selected>Tất cả</option>
                } else {
                    <option value="">Tất cả</option>
                }
                if (pkg == "Dong") {
                    <option value="Dong" selected>Đồng</option>
                } else {
                    <option value="Dong">Đồng</option>
                }
                if (pkg == "Bac") {
                    <option value="Bac" selected>Bạc</option>
                } else {
                    <option value="Bac">Bạc</option>
                }
                if (pkg == "Vang") {
                    <option value="Vang" selected>Vàng</option>
                } else {
                    <option value="Vang">Vàng</option>
                }
                if (pkg == "KimCuong") {
                    <option value="KimCuong" selected>Kim Cương</option>
                } else {
                    <option value="KimCuong">Kim Cương</option>
                }
            }
        </select>
    </div>
    <div class="col-md-3">
        <label class="form-label mb-1">Trạng thái</label>
        <select name="status" class="form-select">
            @{
                var st = Context.Request.Query["status"].ToString();
                if (string.IsNullOrEmpty(st)) {
                    <option value="" selected>Tất cả</option>
                } else {
                    <option value="">Tất cả</option>
                }
                if (st == "pending") {
                    <option value="pending" selected>Chờ duyệt</option>
                } else {
                    <option value="pending">Chờ duyệt</option>
                }
                if (st == "approved") {
                    <option value="approved" selected>Đã duyệt</option>
                } else {
                    <option value="approved">Đã duyệt</option>
                }
            }
        </select>
    </div>
    <div class="col-md-3">
        <label class="form-label mb-1">Tìm kiếm tiêu đề</label>
        <input type="text" name="q" class="form-control" placeholder="Nhập tiêu đề..." value="@Context.Request.Query["q"]" />
    </div>
    <div class="col-md-2">
        <label class="form-label mb-1">Sắp xếp</label>
        <select name="sort" class="form-select">
            @{
                var sort = Context.Request.Query["sort"].ToString();
                if (sort == "created_desc" || string.IsNullOrEmpty(sort)) {
                    <option value="created_desc" selected>Mới nhất</option>
                } else {
                    <option value="created_desc">Mới nhất</option>
                }
                if (sort == "created_asc") {
                    <option value="created_asc" selected>Cũ nhất</option>
                } else {
                    <option value="created_asc">Cũ nhất</option>
                }
                if (sort == "views_desc") {
                    <option value="views_desc" selected>Lượt xem nhiều</option>
                } else {
                    <option value="views_desc">Lượt xem nhiều</option>
                }
                if (sort == "views_asc") {
                    <option value="views_asc" selected>Lượt xem ít</option>
                } else {
                    <option value="views_asc">Lượt xem ít</option>
                }
            }
        </select>
    </div>
    <div class="col-md-1">
        <button type="submit" class="btn btn-primary w-100">Lọc</button>
    </div>
</form>
@if (!Model.Any())
{
    <div class="alert alert-info">Bạn chưa có bài quảng cáo nào.</div>
}
else
{
    <div class="list-group">
        @foreach (var ad in Model)
        {
            <a href="@Url.Action("Details", "AdPosts", new { id = ad.Id })" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                <div>
                    <div class="fw-bold">@ad.Title</div>
                    <div class="small text-muted">@ad.CreatedAt.ToString("dd/MM/yyyy") • Gói: <span class="badge @(ad.PackageType == RentalService.Models.AdPackageType.Dong ? "bg-primary text-white" :
                                                ad.PackageType == RentalService.Models.AdPackageType.Bac ? "bg-secondary text-white" :
                                                ad.PackageType == RentalService.Models.AdPackageType.Vang ? "bg-warning text-dark" :
                                                ad.PackageType == RentalService.Models.AdPackageType.KimCuong ? "bg-info text-white" :
                                                "bg-light text-dark")">
    @ad.PackageType
</span> • Lượt xem: @ad.ViewCount</div>
                </div>
                <span class="badge @(ad.IsActive ? "bg-success" : "bg-secondary")">@(ad.IsActive ? "Đã duyệt" : "Chờ duyệt")</span>
            </a>
        }
    </div>
}
<a href="@Url.Action("Create")" class="btn btn-success mt-4">Đăng bài mới</a>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        if (!form) return;
        form.querySelectorAll('select, input[type="text"]').forEach(function(el) {
            el.addEventListener('change', function() {
                form.submit();
            });
            if (el.tagName === 'INPUT') {
                el.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') form.submit();
                });
            }
        });
    });
</script>
