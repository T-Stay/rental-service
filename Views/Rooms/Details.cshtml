@model RentalService.Models.Room
@{
    ViewData["Title"] = "Room Details";
}
<h2>@Model.Name</h2>
<p><strong>Location:</strong> @Model.Building?.Location</p>
<p><strong>Price:</strong> @Model.Price</p>
<p><strong>Description:</strong> @Model.Description</p>
@if (Model.Images != null && Model.Images.Count > 0)
{
    <div>
        @foreach (var img in Model.Images)
        {
            <img src="@img.ImageUrl" alt="Room Image" style="max-width:200px; margin:5px;" />
        }
    </div>
}
@if (Model.Amenities != null && Model.Amenities.Count > 0)
{
    <p><strong>Amenities:</strong> @string.Join(", ", Model.Amenities.Select(a => a.Name))</p>
}
<a href="@Url.Action("Index")">Back to list</a>
@if (User?.Identity != null && User.Identity.IsAuthenticated && (User.FindFirst("role")?.Value == "customer"))
{
    @await Html.PartialAsync("_FavoriteButton", Model)
    <form method="get" action="@Url.Action("Create", "ViewAppointments")">
        <input type="hidden" name="roomId" value="@Model.Id" />
        <button type="submit" class="btn btn-primary mt-2">Book a Viewing Appointment</button>
    </form>
    <form method="get" action="@Url.Action("Create", "BookingRequests")">
        <input type="hidden" name="roomId" value="@Model.Id" />
        <button type="submit" class="btn btn-success mt-2">Request Booking</button>
    </form>
}
@if (Model.Building?.Host?.ContactInformations != null && Model.Building.Host.ContactInformations.Count > 0)
{
    <div class="mt-3">
        <h5>Host Contact Information</h5>
        <ul>
            @foreach (var c in Model.Building.Host.ContactInformations)
            {
                if (c.Type.ToString() == "FacebookLink")
                {
                    <li><strong>@c.Type:</strong> <a href="@c.Data" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg me-1"></i>View Profile</a></li>
                }
                else if (c.Type.ToString() == "Email")
                {
                    <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy email"><i class="fa fa-copy"></i></button></li>
                }
                else if (c.Type.ToString() == "PhoneNumber")
                {
                    <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy phone"><i class="fa fa-copy"></i></button></li>
                }
                else
                {
                    <li><strong>@c.Type:</strong> @c.Data</li>
                }
            }
        </ul>
    </div>
    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text);
            if (!document.getElementById('copyToast')) {
                var toast = document.createElement('div');
                toast.id = 'copyToast';
                toast.innerText = 'Copied!';
                toast.style.position = 'fixed';
                toast.style.left = '50%';
                toast.style.bottom = '30px';
                toast.style.transform = 'translateX(-50%)';
                toast.style.background = '#333';
                toast.style.color = '#fff';
                toast.style.padding = '8px 16px';
                toast.style.borderRadius = '4px';
                toast.style.zIndex = 9999;
                toast.style.opacity = 0;
                toast.style.transition = 'opacity 0.3s';
                document.body.appendChild(toast);
            }
            var toast = document.getElementById('copyToast');
            toast.style.opacity = 1;
            toast.style.visibility = 'visible';
            setTimeout(function () {
                toast.style.opacity = 0;
                toast.style.visibility = 'hidden';
            }, 1500);
        }
    </script>
    <style>
        .copy-btn {
            border: none;
            background: none;
            color: #007bff;
            cursor: pointer;
            margin-left: 0.5rem;
        }
    </style>
}
@await Html.PartialAsync("_ReviewsPartial", Model.Reviews)
@await Html.PartialAsync("_ReviewForm", Model)
