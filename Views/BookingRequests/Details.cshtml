@model RentalService.Models.BookingRequest
@{
    ViewData["Title"] = "Booking Request Details";
}
<div class="card shadow-sm mb-4">
    <div class="card-header bg-info text-white fw-bold">
        <i class="fa-solid fa-envelope"></i> Booking Request Details
    </div>
    <div class="card-body">
        <p><strong>Room:</strong> 
            @if (Model.Room != null)
            {
                <a href="@Url.Action("Details", "Rooms", new { id = Model.Room.Id })" target="_blank">@Model.Room.Name</a>
            }
            else
            {
                <span class="text-muted">Unknown</span>
            }
        </p>
        <p><strong>Message:</strong> @Model.Message</p>
        <p><strong>Status:</strong> 
            @if (Model.Status.ToString() == "Pending")
            {
                <span class="badge bg-warning">Pending</span>
            }
            else if (Model.Status.ToString() == "Approved")
            {
                <span class="badge bg-success">Approved</span>
            }
            else if (Model.Status.ToString() == "Rejected")
            {
                <span class="badge bg-danger">Rejected</span>
            }
            else
            {
                <span class="badge bg-secondary">@Model.Status</span>
            }
        </p>
        @if (Model.Status.ToString() == "Pending")
        {
            <div class="alert alert-info mt-3">
                <strong>Next Steps:</strong><br />
                Your booking request is pending.<br />
                Please wait for the host to approve or reject your request. You will be notified here and by notification bell when the status changes.
            </div>
        }
        @if (Model.Status.ToString() == "Approved")
        {
            <div class="alert alert-success mt-3">
                <strong>Next Steps:</strong><br />
                Your booking has been approved!<br />
                Please contact the host to finalize your booking and arrange payment if required.<br />
                <span class="text-muted">(Check host contact info below.)</span>
            </div>
            <form method="post" action="#" class="mt-2">
                <button type="button" class="btn btn-primary" disabled>Confirm Booking (Coming Soon)</button>
            </form>
        }
        @if (Model.Status.ToString() == "Rejected")
        {
            <div class="alert alert-danger mt-3">
                <strong>Next Steps:</strong><br />
                Unfortunately, your booking request was rejected by the host.<br />
                You may contact the host for more information or try booking another room.
            </div>
        }
        <p><strong>Created:</strong> @Model.CreatedAt</p>
        @if (Model.Room != null) {
            <p><strong>Price:</strong> @Model.Room.Price.ToString("N0") â‚«</p>
        }
        @if (Model.Room != null && Model.Room.Building != null && Model.Room.Building.Host != null && Model.Room.Building.Host.ContactInformations != null && Model.Room.Building.Host.ContactInformations.Count > 0)
        {
            <div class="mt-3">
                <h5>Host Contact Information</h5>
                <ul>
                    @foreach (var c in Model.Room.Building.Host.ContactInformations)
                    {
                        if (c.Type.ToString() == "FacebookLink")
                        {
                            <li><strong>@c.Type:</strong> <a href="@c.Data" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg me-1"></i>View Profile</a></li>
                        }
                        else if (c.Type.ToString() == "Email")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy email"><i class="fa fa-copy"></i></button></li>
                        }
                        else if (c.Type.ToString() == "PhoneNumber")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy phone"><i class="fa fa-copy"></i></button></li>
                        }
                        else
                        {
                            <li><strong>@c.Type:</strong> @c.Data</li>
                        }
                    }
                </ul>
            </div>
        }
        @if (Model.User != null && Model.User.ContactInformations != null && Model.User.ContactInformations.Count > 0)
        {
            <div class="mt-3">
                <h5>Customer Contact Information</h5>
                <ul>
                    @foreach (var c in Model.User.ContactInformations)
                    {
                        if (c.Type.ToString() == "FacebookLink")
                        {
                            <li><strong>@c.Type:</strong> <a href="@c.Data" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg me-1"></i>View Profile</a></li>
                        }
                        else if (c.Type.ToString() == "Email")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy email"><i class="fa fa-copy"></i></button></li>
                        }
                        else if (c.Type.ToString() == "PhoneNumber")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy phone"><i class="fa fa-copy"></i></button></li>
                        }
                        else
                        {
                            <li><strong>@c.Type:</strong> @c.Data</li>
                        }
                    }
                </ul>
            </div>
        }
        @if (Model.Status.ToString() == "Pending" || Model.Status.ToString() == "Approved")
        {
            <form method="post" action="@Url.Action("Cancel", "BookingRequests")" class="mt-2" onsubmit="return confirm('Are you sure you want to cancel this booking request?');">
                @Html.AntiForgeryToken()
                <input type="hidden" name="id" value="@Model.Id" />
                <button type="submit" class="btn btn-outline-danger"><i class="fa fa-times"></i> Cancel Request</button>
            </form>
        }
    </div>
</div>
<div class="d-flex gap-2">
    <a href="@Url.Action("Index", "Home")" class="btn btn-outline-secondary"><i class="fa-solid fa-gauge-high"></i> Dashboard</a>
    <a href="@Url.Action("Index")" class="btn btn-outline-info"><i class="fa-solid fa-list"></i> Back to Bookings</a>
</div>
<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text);
        if (!document.getElementById('copyToast')) {
            var toast = document.createElement('div');
            toast.id = 'copyToast';
            toast.innerText = 'Copied!';
            toast.style.position = 'fixed';
            toast.style.left = '50%';
            toast.style.bottom = '30px';
            toast.style.transform = 'translateX(-50%)';
            toast.style.background = '#333';
            toast.style.color = '#fff';
            toast.style.padding = '8px 16px';
            toast.style.borderRadius = '4px';
            toast.style.zIndex = 9999;
            toast.style.opacity = 0;
            toast.style.transition = 'opacity 0.3s';
            document.body.appendChild(toast);
        }
        var toast = document.getElementById('copyToast');
        toast.style.opacity = 1;
        toast.style.visibility = 'visible';
        setTimeout(function () {
            toast.style.opacity = 0;
            toast.style.visibility = 'hidden';
        }, 1500);
    }
</script>
<style>
    .copy-btn {
        border: none;
        background: none;
        color: #007bff;
        cursor: pointer;
        margin-left: 0.5rem;
    }
</style>
