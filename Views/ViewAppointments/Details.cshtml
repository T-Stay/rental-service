@model RentalService.Models.ViewAppointment
@{
    ViewData["Title"] = "Chi tiết lịch hẹn xem phòng";
}
<div class="card shadow-sm mb-4">
    <div class="card-header bg-success text-white fw-bold">
        <i class="fa-solid fa-calendar-day"></i> Chi tiết lịch hẹn xem phòng
    </div>
    <div class="card-body">
        <p><strong>Phòng:</strong> 
            @if (Model.Room != null)
            {
                <a href="@Url.Action("Details", "Rooms", new { id = Model.Room.Id })" target="_blank">@Model.Room.Name</a>
            }
            else
            {
                <span class="text-muted">Không xác định</span>
            }
        </p>
        <p><strong>Thời gian:</strong> @Model.AppointmentTime.ToString("g")</p>
        <p><strong>Trạng thái:</strong> 
            @if (Model.Status.ToString() == "Pending")
            {
                <span class="badge bg-warning">Đang chờ</span>
            }
            else if (Model.Status.ToString() == "Confirmed")
            {
                <span class="badge bg-success">Đã xác nhận</span>
            }
            else if (Model.Status.ToString() == "Cancelled")
            {
                <span class="badge bg-danger">Đã hủy</span>
            }
            else
            {
                <span class="badge bg-secondary">@Model.Status</span>
            }
        </p>
        @if (Model.Status.ToString() == "Pending")
        {
            <div class="alert alert-info mt-3">
                <strong>Bước tiếp theo:</strong><br />
                Yêu cầu lịch hẹn của bạn đang chờ xác nhận.<br />
                Vui lòng chờ chủ nhà xác nhận hoặc hủy yêu cầu. Bạn sẽ được thông báo tại đây và qua chuông thông báo khi trạng thái thay đổi.
            </div>
            <form method="post" action="@Url.Action("Cancel", "ViewAppointments")" class="mt-2" onsubmit="return confirm('Bạn có chắc muốn hủy yêu cầu lịch hẹn này?');">
                @Html.AntiForgeryToken()
                <input type="hidden" name="id" value="@Model.Id" />
                <button type="submit" class="btn btn-outline-danger"><i class="fa fa-times"></i> Hủy yêu cầu</button>
            </form>
        }
        else if (Model.Status.ToString() == "Confirmed")
        {
            <div class="alert alert-success mt-3">
                <strong>Đã xác nhận lịch hẹn!</strong><br />
                Vui lòng đến xem phòng đúng giờ đã hẹn. Liên hệ với chủ nhà nếu bạn cần thay đổi lịch hoặc có thắc mắc.
            </div>
        }
        else if (Model.Status.ToString() == "Cancelled")
        {
            <div class="alert alert-danger mt-3">
                <strong>Lịch hẹn đã bị hủy.</strong><br />
                Lịch hẹn này đã bị hủy. Bạn có thể đặt lịch hẹn khác nếu cần.
            </div>
        }
        <p><strong>Ngày tạo:</strong> @Model.CreatedAt</p>
        @if (Model.Room != null && Model.Room.Building != null && Model.Room.Building.Host != null && Model.Room.Building.Host.ContactInformations != null && Model.Room.Building.Host.ContactInformations.Count > 0)
        {
            <div class="mt-3">
                <h5>Thông tin liên hệ của chủ nhà</h5>
                <ul>
                    @foreach (var c in Model.Room.Building.Host.ContactInformations)
                    {
                        if (c.Type.ToString() == "FacebookLink")
                        {
                            <li><strong>@c.Type:</strong> <a href="@c.Data" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg me-1"></i>View Profile</a></li>
                        }
                        else if (c.Type.ToString() == "Email")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Sao chép email"><i class="fa fa-copy"></i></button></li>
                        }
                        else if (c.Type.ToString() == "PhoneNumber")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Sao chép số điện thoại"><i class="fa fa-copy"></i></button></li>
                        }
                        else
                        {
                            <li><strong>@c.Type:</strong> @c.Data</li>
                        }
                    }
                </ul>
            </div>
        }
    </div>
</div>
<div class="d-flex gap-2">
    <a href="@Url.Action("Index", "Home")" class="btn btn-outline-secondary"><i class="fa-solid fa-gauge-high"></i> Bảng điều khiển</a>
    <a href="@Url.Action("Index")" class="btn btn-outline-success"><i class="fa-solid fa-list"></i> Quay lại lịch hẹn</a>
</div>
<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text);
        if (!document.getElementById('copyToast')) {
            var toast = document.createElement('div');
            toast.id = 'copyToast';
            toast.innerText = 'Đã sao chép!';
            toast.style.position = 'fixed';
            toast.style.left = '50%';
            toast.style.bottom = '30px';
            toast.style.transform = 'translateX(-50%)';
            toast.style.background = 'var(--gray-dark)';
            toast.style.color = 'var(--text-light)';
            toast.style.padding = '8px 16px';
            toast.style.borderRadius = '4px';
            toast.style.zIndex = 9999;
            toast.style.opacity = 0;
            toast.style.transition = 'opacity 0.3s';
            document.body.appendChild(toast);
        }
        var toast = document.getElementById('copyToast');
        toast.style.opacity = 1;
        toast.style.visibility = 'visible';
        setTimeout(function () {
            toast.style.opacity = 0;
            toast.style.visibility = 'hidden';
        }, 1500);
    }
</script>
<style>
    .copy-btn {
        border: none;
        background: none;
        color: var(--main-blue);
        cursor: pointer;
        margin-left: 0.5rem;
    }
</style>
