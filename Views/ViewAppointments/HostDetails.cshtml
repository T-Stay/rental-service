@model RentalService.Models.ViewAppointment
@{
    ViewData["Title"] = "Appointment Details (Host)";
}
<div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white fw-bold">
        <i class="fa-solid fa-calendar-day"></i> Appointment Details (Host)
    </div>
    <div class="card-body">
        <p><strong>Room:</strong> 
            @if (Model.Room != null)
            {
                <a href="@Url.Action("Details", "Rooms", new { id = Model.Room.Id })" target="_blank">@Model.Room.Name</a>
            }
            else
            {
                <span class="text-muted">Unknown</span>
            }
        </p>
        <p><strong>Customer:</strong> @Model.User?.Name</p>
        <p><strong>Time:</strong> @Model.AppointmentTime.ToString("g")</p>
        <p><strong>Status:</strong> 
            @if (Model.Status.ToString() == "Pending")
            {
                <span class="badge bg-warning">Pending</span>
            }
            else if (Model.Status.ToString() == "Confirmed")
            {
                <span class="badge bg-success">Confirmed</span>
            }
            else if (Model.Status.ToString() == "Cancelled")
            {
                <span class="badge bg-danger">Cancelled</span>
            }
            else
            {
                <span class="badge bg-secondary">@Model.Status</span>
            }
        </p>
        @if (Model.Status.ToString() == "Pending")
        {
            <div class="alert alert-info mb-2">
                <strong>Guidance:</strong> Accepting this appointment will notify the customer and confirm the viewing. Declining will notify the customer and cancel the appointment.
            </div>
            <div class="mb-3 d-flex gap-2">
                <form method="post" action="@Url.Action("UpdateAppointmentStatus", "ViewAppointments")" style="display:inline;">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="@Model.Id" />
                    <button type="submit" name="action" value="accept" class="btn btn-success me-2">Accept</button>
                    <button type="submit" name="action" value="decline" class="btn btn-danger">Decline</button>
                </form>
            </div>
        }
        else if (Model.Status.ToString() == "Confirmed")
        {
            <div class="alert alert-success mb-2">
                <strong>Appointment Confirmed.</strong> The customer has been notified. Please prepare for the viewing.
            </div>
        }
        else if (Model.Status.ToString() == "Cancelled")
        {
            <div class="alert alert-danger mb-2">
                <strong>Appointment Cancelled.</strong> The customer has been notified. No further action is required.
            </div>
        }
        <p><strong>Created:</strong> @Model.CreatedAt</p>
        @if (Model.User != null && Model.User.ContactInformations != null && Model.User.ContactInformations.Count > 0)
        {
            <div class="mt-3">
                <h5>Customer Contact Information</h5>
                <ul>
                    @foreach (var c in Model.User.ContactInformations)
                    {
                        if (c.Type.ToString() == "FacebookLink")
                        {
                            <li><strong>@c.Type:</strong> <a href="@c.Data" target="_blank" rel="noopener"><i class="fab fa-facebook fa-lg me-1"></i>View Profile</a></li>
                        }
                        else if (c.Type.ToString() == "Email")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy email"><i class="fa fa-copy"></i></button></li>
                        }
                        else if (c.Type.ToString() == "PhoneNumber")
                        {
                            <li><strong>@c.Type:</strong> @c.Data <button class="copy-btn" onclick="copyToClipboard('@c.Data')" title="Copy phone"><i class="fa fa-copy"></i></button></li>
                        }
                        else
                        {
                            <li><strong>@c.Type:</strong> @c.Data</li>
                        }
                    }
                </ul>
            </div>
        }
    </div>
</div>
<div class="d-flex gap-2">
    <a href="@Url.Action("HostRoomAppointments", "ViewAppointments")" class="btn btn-outline-secondary"><i class="fa-solid fa-list"></i> Back to Appointments</a>
</div>
<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text);
        if (!document.getElementById('copyToast')) {
            var toast = document.createElement('div');
            toast.id = 'copyToast';
            toast.innerText = 'Copied!';
            toast.style.position = 'fixed';
            toast.style.left = '50%';
            toast.style.bottom = '30px';
            toast.style.transform = 'translateX(-50%)';
            toast.style.background = '#333';
            toast.style.color = '#fff';
            toast.style.padding = '8px 16px';
            toast.style.borderRadius = '4px';
            toast.style.zIndex = 9999;
            toast.style.opacity = 0;
            toast.style.transition = 'opacity 0.3s';
            document.body.appendChild(toast);
        }
        var toast = document.getElementById('copyToast');
        toast.style.opacity = 1;
        toast.style.visibility = 'visible';
        setTimeout(function () {
            toast.style.opacity = 0;
            toast.style.visibility = 'hidden';
        }, 1500);
    }
</script>
<style>
    .copy-btn {
        border: none;
        background: none;
        color: #007bff;
        cursor: pointer;
        margin-left: 0.5rem;
    }
</style>
